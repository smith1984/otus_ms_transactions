# otus_ms_transactions (Распределенные транзакции)
# add: otus_ms_streaming (Потоковая обработка)

## Зависимости

Для выполнения задания использовались следующие зависимости:

- [Minikube 1.29.0](https://github.com/kubernetes/minikube/releases/tag/v1.29.0)
- [Kubectl 0.26.1](https://github.com/kubernetes/kubectl/releases/tag/v0.26.1)
- [Istioctl 1.17.0](https://github.com/istio/istio/releases/tag/1.17.0)
- [Heml 3.3.4](https://github.com/helm/helm/releases/tag/v3.3.4)

## Ресурсы

Для запуска всех сервисов необходимо выделение ресурсов в minikube: 4CPU 8GB RAM

## Описание
Реализация распределённых транзакции с использованием паттерна Сага с оркестратором

Реализованы следующие сервисы "Заказ", "Платеж", "Склад", "Доставка"
Для сервиса "Заказ", в рамках метода "создание заказа" происходит вызов оркестратора, которые запускает запросы к связанным сервисам
1. Сервис "Платеж" выполняет оплату товара 
2. Сервис "Склад" резервирует товар 
3. Сервис "Доставка" резервирует доставку на определённое время
    
Если хотя бы от одного из сервисов приходит не успешный результат, то происходит откат всех успешных событий и заказ переходит в статус отменён.

В рамках ДЗ по потоковой обработки добавлены сервисы "Пользователь", "Биллинг", "Нотификация"
1. Сервис "Пользователь" управляет пользователями интернет-магазина
2. Сервис "Биллинг" отвечает за кошелек пользователя (пополнение, оплата товара)
3. Сервис "Нотификация" отправляет сообщение об статусе операции в биллинге

При проведении операции связанной с оплатой товара, транзакция отправляется в kafka используя механизм CDC и технологию debezium, 
сервис нотификации читает топик кафка и производит нотификацию пользователя (используется заглушка в виде сохранения сообщения в БД)

## Разворачивание инфраструктуры и сервисов
Выполнить
> sh ./install.sh

## Тестирование
> newman run ./hw_transactions_postman_collection.json

## Тестирование потоковой обработки
> newman run ./hw_streaming_postman_collection.json

## Удаление инфраструктуры и сервисов
> sh ./delete.sh